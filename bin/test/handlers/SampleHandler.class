package myplugin.handlers;

import org.eclipse.core.commands.AbstractHandler;
import org.eclipse.core.commands.ExecutionEvent;
import org.eclipse.core.commands.ExecutionException;
import org.eclipse.swt.SWT;
import org.eclipse.swt.layout.FillLayout;
import org.eclipse.swt.widgets.Display;
import org.eclipse.swt.widgets.Shell;
import org.eclipse.swt.widgets.Table;
import org.eclipse.swt.widgets.TableColumn;
import org.eclipse.swt.widgets.TableItem;

import com.compuware.fileaid.utilities.search.mvs.internal.FASearchEngine;
import com.compuware.fileaid.utilities.search.mvs.internal.FASearchQuery;
import com.compuware.fileaid.utilities.search.mvs.internal.FASearchResult;
import com.compuware.fileaid.utilities.search.mvs.internal.FASearchResultCollector;

import java.util.List;

public class SampleHandler extends AbstractHandler {
    @Override
    public Object execute(ExecutionEvent event) throws ExecutionException {
        Display display = Display.getDefault();
        Shell shell = new Shell(display);
        shell.setText("Résultats recherche CALL");
        shell.setLayout(new FillLayout());
        shell.setSize(800, 400);

        Table table = new Table(shell, SWT.BORDER | SWT.V_SCROLL | SWT.H_SCROLL);
        table.setHeaderVisible(true);
        table.setLinesVisible(true);

        new TableColumn(table, SWT.NONE).setText("Dataset");
        new TableColumn(table, SWT.NONE).setText("Membre");
        new TableColumn(table, SWT.NONE).setText("Ligne");
        new TableColumn(table, SWT.NONE).setText("Contenu");

        try {
            // Étape 1 : Création de la requête
            FASearchQuery query = new FASearchQuery();
            query.setSearchText("CALL");  // texte à chercher
            query.setDatasetName("USER.SUN.DATA.*");  // adapte à ton contexte

            // Étape 2 : Collecteur de résultats
            FASearchResultCollector collector = new FASearchResultCollector();

            // Étape 3 : Exécution
            FASearchEngine engine = new FASearchEngine();
            engine.search(query, collector);

            // Étape 4 : Ajout des résultats à la table
            List<FASearchResult> results = collector.getResults();
            for (FASearchResult result : results) {
                TableItem item = new TableItem(table, SWT.NONE);
                item.setText(0, result.getDatasetName());
                item.setText(1, result.getMemberName());
                item.setText(2, String.valueOf(result.getLineNumber()));
                item.setText(3, result.getMatchedLine());
            }

            // Redimension automatique des colonnes
            for (TableColumn col : table.getColumns()) {
                col.pack();
            }

            shell.open();
        } catch (Exception e) {
            e.printStackTrace();
        }

        return null;
    }
}
